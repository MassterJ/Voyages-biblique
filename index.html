<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voyages Bibliques Interactifs</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-container {
            display: flex;
            flex: 1;
            height: calc(100vh - 120px);
        }

        .sidebar {
            width: 350px;
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5rem;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .journey-selector {
            margin-bottom: 2rem;
        }

        .journey-selector h3 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }

        .journey-btn {
            display: block;
            width: 100%;
            padding: 0.8rem 1rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-align: left;
        }

        .journey-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .journey-btn.active {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
        }

        .info-panel {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1rem;
            border-left: 4px solid #667eea;
        }

        .info-panel h4 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .info-panel p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 0.8rem;
        }

        .verse-quote {
            background: rgba(102, 126, 234, 0.1);
            border-left: 3px solid #667eea;
            padding: 1rem;
            margin: 1rem 0;
            font-style: italic;
            border-radius: 0 8px 8px 0;
        }

        .verse-quote cite {
            display: block;
            text-align: right;
            font-weight: bold;
            color: #667eea;
            margin-top: 0.5rem;
        }

        #map {
            flex: 1;
            position: relative;
        }

        .custom-popup {
            max-width: 300px;
        }

        .popup-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.8rem;
            margin: -10px -10px 10px -10px;
            border-radius: 5px 5px 0 0;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .popup-content {
            padding: 0.5rem 0;
        }

        .popup-verse {
            background: #f0f4ff;
            padding: 0.8rem;
            border-left: 3px solid #667eea;
            margin-top: 0.8rem;
            font-style: italic;
            border-radius: 0 5px 5px 0;
        }

        .popup-reference {
            color: #667eea;
            font-weight: bold;
            text-align: right;
            margin-top: 0.5rem;
        }

        .precision-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        .precision-badge.approximate {
            background: #ffc107;
            color: #333;
        }

        .precision-badge.estimated {
            background: #dc3545;
        }

        .audio-controls {
            margin-top: 1rem;
            padding: 1rem;
            background: #e8f0fe;
            border-radius: 8px;
            text-align: center;
        }

        .audio-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0 0.3rem;
            transition: background 0.3s ease;
        }

        .audio-btn:hover {
            background: #5a6fd8;
        }

        .audio-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .legend {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }

        .legend h4 {
            margin-bottom: 0.8rem;
            color: #333;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 0.8rem;
            border: 2px solid rgba(0, 0, 0, 0.2);
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            z-index: 2000;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                height: auto;
            }

            .sidebar {
                width: 100%;
                height: auto;
                max-height: 40vh;
            }

            #map {
                height: 60vh;
            }

            .header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Chargement des voyages bibliques...</p>
    </div>

    <header class="header">
        <h1>üó∫Ô∏è Voyages Bibliques Interactifs</h1>
        <p>Explorez les p√©riples des figures bibliques avec des cartes d√©taill√©es et des r√©cits audio</p>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <div class="journey-selector">
                <h3>üìñ S√©lectionnez un voyage</h3>
                <div id="journey-buttons"></div>
            </div>

            <div class="info-panel" id="info-panel">
                <h4>‚ÑπÔ∏è Informations</h4>
                <p>S√©lectionnez un voyage pour commencer l'exploration interactive.</p>
            </div>

            <div class="audio-controls" id="audio-controls" style="display: none;">
                <h4>üéµ Contr√¥les Audio</h4>
                <button class="audio-btn" id="play-btn">‚ñ∂Ô∏è Lecture</button>
                <button class="audio-btn" id="pause-btn">‚è∏Ô∏è Pause</button>
                <button class="audio-btn" id="stop-btn">‚èπÔ∏è Arr√™t</button>
                <div style="margin-top: 0.8rem;">
                    <small id="audio-status">Pr√™t</small>
                </div>
            </div>
        </aside>

        <main id="map"></main>
    </div>

    <div class="legend">
        <h4>üóÇÔ∏è L√©gende</h4>
        <div class="legend-item">
            <div class="legend-color" style="background: #ff6b6b;"></div>
            <span>D√©part du voyage</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #4ecdc4;"></div>
            <span>√âtapes du parcours</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #45b7d1;"></div>
            <span>Destination finale</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #96ceb4;"></div>
            <span>Lieux importants</span>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Configuration et donn√©es des voyages
        const journeyData = {
            "abraham": {
                title: "Le voyage d'Abraham",
                description: "De Ur en Chald√©e vers la Terre Promise",
                audio: "audio/abraham_journey.mp3",
                route: [
                    {
                        name: "Ur en Chald√©e",
                        coords: [30.9625, 46.1033],
                        type: "start",
                        precision: "estimated",
                        verse: "L'√âternel dit √† Abram: Va-t-en de ton pays, de ta patrie, et de la maison de ton p√®re, dans le pays que je te montrerai.",
                        ref_url: "Gen√®se 12:1"
                    },
                    {
                        name: "Harran",
                        coords: [36.8641, 39.0397],
                        type: "waypoint",
                        precision: "precise",
                        verse: "T√©rah prit Abram, son fils, et Lot, fils d'Haran, fils de son fils, et Sara√Ø, sa belle-fille, femme d'Abram, son fils. Ils sortirent ensemble d'Ur en Chald√©e, pour aller au pays de Canaan. Ils vinrent jusqu'√† Harran, et ils y habit√®rent.",
                        ref_url: "Gen√®se 11:31"
                    },
                    {
                        name: "Sichem",
                        coords: [32.2141, 35.2892],
                        type: "waypoint",
                        precision: "precise",
                        verse: "Abram traversa le pays jusqu'au lieu nomm√© Sichem, jusqu'aux ch√™nes de Mor√©. Les Canan√©ens √©taient alors dans le pays.",
                        ref_url: "Gen√®se 12:6"
                    },
                    {
                        name: "B√©thel",
                        coords: [31.9308, 35.2203],
                        type: "destination",
                        precision: "precise",
                        verse: "Il se transporta de l√† vers la montagne, √† l'orient de B√©thel, et il dressa ses tentes, ayant B√©thel √† l'occident et A√Ø √† l'orient. Il b√¢tit encore l√† un autel √† l'√âternel, et il invoqua le nom de l'√âternel.",
                        ref_url: "Gen√®se 12:8"
                    }
                ]
            },
            "exodus": {
                title: "L'Exode - Sortie d'√âgypte",
                description: "Le voyage du peuple h√©breu de l'√âgypte vers la Terre Promise",
                audio: "audio/exodus_journey.mp3",
                route: [
                    {
                        name: "Rams√®s (√âgypte)",
                        coords: [30.9625, 31.8996],
                        type: "start",
                        precision: "approximate",
                        verse: "Les enfants d'Isra√´l partirent de Rams√®s pour Succoth au nombre d'environ six cent mille hommes de pied, sans les enfants.",
                        ref_url: "Exode 12:37"
                    },
                    {
                        name: "Mer Rouge",
                        coords: [29.5, 32.8],
                        type: "waypoint",
                        precision: "estimated",
                        verse: "Mo√Øse √©tendit sa main sur la mer. Et l'√âternel refoula la mer par un vent d'orient, qui souffla avec imp√©tuosit√© toute la nuit; il mit la mer √† sec, et les eaux se fendirent.",
                        ref_url: "Exode 14:21"
                    },
                    {
                        name: "Mont Sina√Ø",
                        coords: [28.5362, 33.9734],
                        type: "waypoint",
                        precision: "approximate",
                        verse: "Le troisi√®me mois apr√®s leur sortie du pays d'√âgypte, les enfants d'Isra√´l arriv√®rent ce jour-l√† au d√©sert de Sina√Ø.",
                        ref_url: "Exode 19:1"
                    },
                    {
                        name: "Canaan",
                        coords: [31.7683, 35.2137],
                        type: "destination",
                        precision: "precise",
                        verse: "Je vous ferai entrer dans le pays que j'ai jur√© de donner √† Abraham, √† Isaac et √† Jacob; je vous le donnerai en possession. Je suis l'√âternel.",
                        ref_url: "Exode 6:8"
                    }
                ]
            },
            "paul": {
                title: "Les voyages missionnaires de Paul",
                description: "Premier voyage missionnaire de l'ap√¥tre Paul",
                audio: "audio/paul_journey.mp3",
                route: [
                    {
                        name: "Antioche de Syrie",
                        coords: [36.2012, 36.1607],
                        type: "start",
                        precision: "precise",
                        verse: "Barnabas et Saul, envoy√©s par le Saint-Esprit, descendirent √† S√©leucie, et de l√† ils s'embarqu√®rent pour Chypre.",
                        ref_url: "Actes 13:4"
                    },
                    {
                        name: "Chypre (Salamine)",
                        coords: [35.1856, 33.9066],
                        type: "waypoint",
                        precision: "precise",
                        verse: "Arriv√©s √† Salamine, ils annonc√®rent la parole de Dieu dans les synagogues des Juifs.",
                        ref_url: "Actes 13:5"
                    },
                    {
                        name: "Antioche de Pisidie",
                        coords: [38.3167, 31.1833],
                        type: "waypoint",
                        precision: "approximate",
                        verse: "De Perge ils poursuivirent leur route, et arriv√®rent √† Antioche de Pisidie. S'√©tant rendus √† la synagogue le jour du sabbat, ils s'assirent.",
                        ref_url: "Actes 13:14"
                    },
                    {
                        name: "Lystre",
                        coords: [37.6418, 32.4903],
                        type: "destination",
                        precision: "approximate",
                        verse: "√Ä Lystre, se trouvait assis un homme impotent des pieds, boiteux de naissance, et qui n'avait jamais march√©.",
                        ref_url: "Actes 14:8"
                    }
                ]
            },
            "jonah": {
                title: "Le voyage de Jonas",
                description: "De Jopp√© vers Tarsis, puis vers Ninive",
                audio: "audio/jonah_journey.mp3",
                route: [
                    {
                        name: "Jopp√©",
                        coords: [32.0504, 34.7518],
                        type: "start",
                        precision: "precise",
                        verse: "Et Jonas se leva pour s'enfuir √† Tarsis, loin de la face de l'√âternel. Il descendit √† Jopp√©, et il trouva un navire qui allait √† Tarsis.",
                        ref_url: "Jonas 1:3"
                    },
                    {
                        name: "En mer (temp√™te)",
                        coords: [34.5, 34.0],
                        type: "waypoint",
                        precision: "estimated",
                        verse: "Mais l'√âternel fit souffler sur la mer un vent imp√©tueux, et il s'√©leva sur la mer une grande temp√™te.",
                        ref_url: "Jonas 1:4"
                    },
                    {
                        name: "Ninive",
                        coords: [36.3489, 43.1589],
                        type: "destination",
                        precision: "precise",
                        verse: "La parole de l'√âternel fut adress√©e √† Jonas une seconde fois, en ces mots: L√®ve-toi, va √† Ninive, la grande ville, et proclames-y la pr√©dication que je t'ordonne!",
                        ref_url: "Jonas 3:1-2"
                    }
                ]
            }
        };

        // Variables globales
        let map;
        let currentJourney = null;
        let currentAudio = null;
        let routeLayers = [];

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            createJourneyButtons();
            hideLoading();
        });

        function initializeMap() {
            // Cr√©er la carte centr√©e sur le Moyen-Orient
            map = L.map('map').setView([32.0, 35.0], 6);

            // Ajouter la couche de tuiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(map);
        }

        function createJourneyButtons() {
            const container = document.getElementById('journey-buttons');

            Object.keys(journeyData).forEach(key => {
                const journey = journeyData[key];
                const button = document.createElement('button');
                button.className = 'journey-btn';
                button.textContent = journey.title;
                button.onclick = () => loadJourney(key);
                container.appendChild(button);
            });
        }

        function loadJourney(journeyKey) {
            // Supprimer les anciennes couches
            clearMap();

            // Mettre √† jour l'interface
            updateActiveButton(journeyKey);
            currentJourney = journeyKey;

            const journey = journeyData[journeyKey];
            const route = journey.route;

            // Afficher les informations
            updateInfoDisplay(journey);

            // Cr√©er les marqueurs et la route
            const routeCoords = [];

            route.forEach((step, index) => {
                const [lat, lng] = step.coords;
                routeCoords.push([lat, lng]);

                // Cr√©er le marqueur
                const marker = createMarker(step, index);
                marker.addTo(map);
                routeLayers.push(marker);
            });

            // Cr√©er la ligne de route
            const routeLine = L.polyline(routeCoords, {
                color: '#667eea',
                weight: 3,
                opacity: 0.8,
                dashArray: '10, 5'
            }).addTo(map);
            routeLayers.push(routeLine);

            // Ajuster la vue pour inclure tous les points
            const group = new L.featureGroup(routeLayers);
            map.fitBounds(group.getBounds().pad(0.1));

            // Afficher les contr√¥les audio
            showAudioControls(journey);
        }

        function createMarker(step, index) {
            const [lat, lng] = step.coords;

            // D√©finir la couleur selon le type
            const colors = {
                start: '#ff6b6b',
                waypoint: '#4ecdc4',
                destination: '#45b7d1',
                important: '#96ceb4'
            };

            const color = colors[step.type] || '#4ecdc4';

            // Cr√©er l'ic√¥ne personnalis√©e
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="
                    background-color: ${color};
                    width: 25px;
                    height: 25px;
                    border-radius: 50%;
                    border: 3px solid white;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                    font-size: 12px;
                ">${index + 1}</div>`,
                iconSize: [25, 25],
                iconAnchor: [12, 12]
            });

            // Cr√©er le marqueur
            const marker = L.marker([lat, lng], { icon: icon });

            // Ajouter le popup
            const popupContent = createPopup(step);
            marker.bindPopup(popupContent, {
                maxWidth: 300,
                className: 'custom-popup'
            });

            return marker;
        }

        function createPopup(step) {
            const precisionBadge = `<span class="precision-badge ${step.precision}">${step.precision === 'precise' ? 'Pr√©cis' : step.precision === 'approximate' ? 'Approximatif' : 'Estim√©'}</span>`;

            return `
                <div class="popup-header">
                    ${step.name} ${precisionBadge}
                </div>
                <div class="popup-content">
                    <div class="popup-verse">
                        "${step.verse}"
                        <div class="popup-reference">${step.ref_url}</div>
                    </div>
                </div>
            `;
        }

        function updateInfoDisplay(journey) {
            const panel = document.getElementById('info-panel');
            panel.innerHTML = `
                <h4>üìç ${journey.title}</h4>
                <p>${journey.description}</p>
                <div class="verse-quote">
                    <p>${journey.route[0].verse}</p>
                    <cite>${journey.route[0].ref_url}</cite>
                </div>
                <p><strong>√âtapes du voyage:</strong> ${journey.route.length}</p>
                <p><strong>Distance approximative:</strong> Calcul√©e automatiquement</p>
            `;
        }

        function updateActiveButton(activeKey) {
            document.querySelectorAll('.journey-btn').forEach((btn, index) => {
                btn.classList.remove('active');
                if (Object.keys(journeyData)[index] === activeKey) {
                    btn.classList.add('active');
                }
            });
        }

        function clearMap() {
            routeLayers.forEach(layer => {
                map.removeLayer(layer);
            });
            routeLayers = [];
        }

        function showAudioControls(journey) {
            const controls = document.getElementById('audio-controls');
            controls.style.display = 'block';

            const playBtn = document.getElementById('play-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const stopBtn = document.getElementById('stop-btn');
            const status = document.getElementById('audio-status');

            // Nettoyer l'ancien audio
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }

            // Cr√©er le nouveau audio
            currentAudio = new Audio(journey.audio);

            // Gestionnaires d'√©v√©nements
            playBtn.onclick = () => {
                if (currentAudio) {
                    currentAudio.play().catch(e => {
                        status.textContent = 'Erreur de lecture audio';
                        console.error('Erreur audio:', e);
                    });
                    status.textContent = 'Lecture en cours...';
                }
            };

            pauseBtn.onclick = () => {
                if (currentAudio) {
                    currentAudio.pause();
                    status.textContent = 'En pause';
                }
            };

            stopBtn.onclick = () => {
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                    status.textContent = 'Arr√™t√©';
                }
            };

            // √âv√©nements audio
            currentAudio.onended = () => {
                status.textContent = 'Termin√©';
            };

            currentAudio.onerror = () => {
                status.textContent = 'Fichier audio non disponible';
            };

            status.textContent = 'Pr√™t pour la lecture';
        }

        function hideLoading() {
            const loading = document.getElementById('loading');
            setTimeout(() => {
                loading.style.display = 'none';
            }, 1000);
        }

        // Gestion responsive
        window.addEventListener('resize', function() {
            if (map) {
                map.invalidateSize();
            }
        });
    </script>
</body>
</html>